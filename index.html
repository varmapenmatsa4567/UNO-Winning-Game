<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNO Score Counter</title>

<style>
body{
  margin:0;
  font-family:'Segoe UI',Arial;
  background:linear-gradient(135deg,#ff5252,#ff9800);
  min-height:100vh;
}

.container{max-width:900px;margin:auto;padding:16px}

.card{
  background:white;
  border-radius:14px;
  padding:16px;
  box-shadow:0 8px 20px rgba(0,0,0,.25);
}

h1,h2{text-align:center;margin:0 0 10px}

input,select,button{
  padding:12px;
  width:100%;
  margin:6px 0;
  font-size:16px;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  background:#ff5252;
  color:white;
  border:none;
}

.secondary{background:#333}
.hidden{display:none}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  background:white;
  border-radius:12px;
  overflow:hidden;
}

th{background:#333;color:white}
th,td{
  padding:10px;
  text-align:center;
  border-bottom:1px solid #eee;
}

tfoot td{
  background:#fff8e1;
  font-weight:bold;
}

.bonus{background:#e3f2fd}
.highest{background:#c8e6c9 !important;font-weight:bold}

/* Floating Buttons */
.fab{
  position:fixed;
  right:20px;
  width:60px;
  height:60px;
  border-radius:50%;
  font-size:26px;
  box-shadow:0 4px 10px rgba(0,0,0,.4);
}
#roundBtn{bottom:20px}
#bonusBtn{bottom:95px;background:#2196f3}
#newGameBtn{
  position:fixed;
  left:20px;
  bottom:20px;
  width:120px;
  border-radius:25px;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:1000;
}
.modal.show{display:flex}

.modal-content{
  background:white;
  padding:20px;
  border-radius:12px;
  width:90%;
  max-width:350px;
}
</style>
</head>

<body>

<div class="container">

<div class="card">
<h1>UNO Score Counter</h1>

<div id="setup">
<h2>Game Setup</h2>

<input id="playerCount" type="number" min="2" placeholder="Number of Players">
<div id="playerInputs"></div>

<input id="limit" type="number" placeholder="Winning Score Limit">

<button onclick="startGame()">Start Game</button>
</div>
</div>

<br>

<div id="game" class="hidden card">
<h2>Scoreboard</h2>
<table id="scoreTable"></table>
</div>

</div>

<button id="roundBtn" class="fab hidden" onclick="addRound()">+</button>
<button id="bonusBtn" class="fab hidden" onclick="openBonus()">‚òÖ</button>
<button id="newGameBtn" class="secondary hidden" onclick="newGame()">New Game</button>

<!-- BONUS MODAL -->
<div id="bonusModal" class="modal">
  <div class="modal-content">
    <h3>Add Bonus</h3>

    <select id="bonusPlayer"></select>
    <input id="bonusScore" type="number" placeholder="Bonus Score">

    <button onclick="confirmBonus()">Add Bonus</button>
    <button class="secondary" onclick="closeBonus()">Cancel</button>
  </div>
</div>

<script>
let players=[], rows=[], totals=[], limitValue=0;

/* ---------- STORAGE ---------- */
function saveGame(){
  localStorage.setItem("unoRace",
    JSON.stringify({players,rows,limitValue}));
}
function loadGame(){
  let d=localStorage.getItem("unoRace");
  if(!d) return;
  let g=JSON.parse(d);
  players=g.players;
  rows=g.rows;
  limitValue=g.limitValue;
  setupToGame();
  rebuild();
}
window.onload=loadGame;

/* ---------- SETUP ---------- */
playerCount.oninput=()=>{
  playerInputs.innerHTML="";
  for(let i=0;i<playerCount.value;i++)
    playerInputs.innerHTML+=`<input id="p${i}" placeholder="Player ${i+1}">`;
}

function startGame(){
  if(!playerCount.value||!limit.value)
    return alert("Fill all fields");

  players=[]; rows=[];
  limitValue=parseInt(limit.value);

  for(let i=0;i<playerCount.value;i++)
    players.push(document.getElementById("p"+i).value||"Player "+(i+1));

  setupToGame();
  buildTable();
  saveGame();
}

function setupToGame(){
  setup.classList.add("hidden");
  game.classList.remove("hidden");
  roundBtn.classList.remove("hidden");
  bonusBtn.classList.remove("hidden");
  newGameBtn.classList.remove("hidden");
}

/* ---------- TABLE ---------- */
function buildTable(){
  scoreTable.innerHTML="";
  let h="<tr><th>Round</th>";
  players.forEach(p=>h+=`<th>${p}</th>`);
  h+="<th></th></tr>";
  scoreTable.innerHTML+=h;

  let f="<tfoot><tr><td>Total</td>";
  players.forEach((p,i)=>f+=`<td id='t${i}'>0</td>`);
  f+="<td></td></tr></tfoot>";
  scoreTable.innerHTML+=f;
}

function rebuild(){
  buildTable();
  rows.forEach((r,i)=>insertRow(r,i));
  recalcTotals();
}

/* ---------- ADD ROUND ---------- */
function addRound(){
  let scores=[];
  for(let i=0;i<players.length;i++){
    let v=prompt(`Score for ${players[i]}`);
    if(v===null) return;
    scores.push(parseInt(v)||0);
  }
  rows.push({type:"round",scores});
  insertRow(rows[rows.length-1],rows.length-1);
  recalcTotals(); saveGame(); checkWinner();
}

/* ---------- BONUS ---------- */
function openBonus(){
  let sel=document.getElementById("bonusPlayer");
  sel.innerHTML="";
  players.forEach((p,i)=>{
    let o=document.createElement("option");
    o.value=i; o.text=p;
    sel.appendChild(o);
  });
  bonusScore.value="";
  bonusModal.classList.add("show");
}

function closeBonus(){
  bonusModal.classList.remove("show");
}

function confirmBonus(){
  let idx=parseInt(bonusPlayer.value);
  let val=parseInt(bonusScore.value);
  if(isNaN(val)) return alert("Enter bonus score");

  let scores=players.map((p,i)=>i===idx?val:0);
  rows.push({type:"bonus",scores});
  insertRow(rows[rows.length-1],rows.length-1,true);

  closeBonus();
  recalcTotals(); saveGame(); checkWinner();
}

/* ---------- INSERT ROW ---------- */
function insertRow(r,index,isBonus=false){
  let row=scoreTable.insertRow(scoreTable.rows.length-1);
  if(isBonus) row.classList.add("bonus");

  let roundNumber =
    r.type==="round"
      ? rows.filter(x=>x.type==="round").length
      : "Bonus";

  row.insertCell(0).innerText=roundNumber;

  r.scores.forEach((s,col)=>{
    let cell=row.insertCell();
    cell.innerText=s;
    cell.onclick=()=>editCell(index,col);
  });

  let del=row.insertCell();
  del.innerHTML=`<button style="background:#d32f2f" onclick="deleteRow(${index})">X</button>`;
}

/* ---------- EDIT CELL ---------- */
function editCell(r,c){
  let cur=rows[r].scores[c];
  let v=prompt("Edit score:",cur);
  if(v===null) return;
  rows[r].scores[c]=parseInt(v)||0;
  rebuild(); saveGame(); checkWinner();
}

/* ---------- DELETE ROW ---------- */
function deleteRow(i){
  if(!confirm("Delete this row?"))return;
  rows.splice(i,1);
  rebuild(); saveGame();
}

/* ---------- TOTALS ---------- */
function recalcTotals(){
  totals=new Array(players.length).fill(0);
  rows.forEach(r=>{
    r.scores.forEach((s,i)=>totals[i]+=s);
  });

  let max=Math.max(...totals);

  totals.forEach((t,i)=>{
    let td=document.getElementById("t"+i);
    td.innerText=t;
    td.classList.remove("highest");
    if(t===max && max>0) td.classList.add("highest");
  });
}

/* ---------- WINNER ---------- */
function checkWinner(){
  totals.forEach((t,i)=>{
    if(t>=limitValue){
      alert("üèÜ Winner: "+players[i]);
      roundBtn.classList.add("hidden");
      bonusBtn.classList.add("hidden");
    }
  });
}

/* ---------- NEW GAME ---------- */
function newGame(){
  if(!confirm("Start new game?"))return;
  localStorage.removeItem("unoRace");
  location.reload();
}
</script>


</body>
</html>
